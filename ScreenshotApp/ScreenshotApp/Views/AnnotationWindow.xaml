<Window x:Class="ScreenshotApp.Views.AnnotationWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ScreenshotApp.Views"
        mc:Ignorable="d"
        Title="Annotation Canvas"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        WindowState="Maximized"
        Topmost="True"
        ResizeMode="NoResize"
        ShowInTaskbar="False"
        SnapsToDevicePixels="True"
        UseLayoutRounding="True"
        Loaded="OnWindowLoaded"
        Closing="OnWindowClosing">

    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Window.Resources>

    <Grid>
        <!-- Semi-transparent backdrop (Deep Ocean #023047 at 95% opacity) -->
        <Rectangle Fill="#023047" Opacity="0.95"/>

        <!-- Main content container with Canvas for absolute positioning -->
        <Canvas x:Name="MainCanvas"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Window}}"
                Height="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=Window}}">
            <!-- Captured image display centered -->
            <Image x:Name="CapturedImageControl"
                   Source="{Binding CapturedImage}"
                   Stretch="None"
                   Canvas.Left="{Binding CaptureRegion.X}"
                   Canvas.Top="{Binding CaptureRegion.Y}"
                   RenderOptions.BitmapScalingMode="HighQuality"
                   SnapsToDevicePixels="True"/>

            <!-- Annotation canvas overlay fills entire screen for drawing -->
            <Canvas x:Name="AnnotationCanvas"
                    Width="{Binding ActualWidth, RelativeSource={RelativeSource AncestorType=Window}}"
                    Height="{Binding ActualHeight, RelativeSource={RelativeSource AncestorType=Window}}"
                    Background="Transparent"/>

            <!-- Floating toolbar positioned at selection corner -->
            <local:FloatingToolbar x:Name="Toolbar"
                                   Canvas.Left="{Binding ToolbarLeft}"
                                   Canvas.Top="{Binding ToolbarTop}"
                                   Visibility="{Binding IsAnnotationWindowVisible, Converter={StaticResource BooleanToVisibilityConverter}}"/>
        </Canvas>

        <!-- Instructions overlay (fades out after 2 seconds) -->
        <TextBlock x:Name="InstructionsText"
                   Text="Press ESC to close"
                   Foreground="#8ECAE6"
                   FontSize="14"
                   Opacity="0.8"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Bottom"
                   Margin="0,0,0,40"/>
    </Grid>
</Window>
